- hosts: "{{ target_hosts | default('localhost') }}"
  become: yes
  become_user: root

  tasks:
    - name: build snippet from swagger
      shell: ./swagger_to_conf.sh -l -u {{ upstream_ip }} {{ input_file }} | grep -v shyaml
      register: nginx_snippet
    - debug: var=nginx_snippet.stdout
    - set_fact: config_snippet={{nginx_snippet.stdout}}
    - name: replace config
      template:
        src: api-gateway.j2
        dest: "{{ input_file }}.conf"
      delegate_to: localhost
